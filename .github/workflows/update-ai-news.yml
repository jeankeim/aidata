name: Update AI News

on:
  # å®šæ—¶è§¦å‘ï¼šæ¯å‘¨ä¸€æ—©ä¸Š9ç‚¹ï¼ˆUTCæ—¶é—´ï¼‰
  schedule:
    - cron: '0 9 * * 1'
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  update-news:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install feedparser requests
    
    - name: Run update script
      run: |
        python scripts/update_ai_news.py
    
    - name: Check for changes
      id: check_changes
      run: |
        if git diff --quiet data/ai-news.json; then
          echo "has_changes=false" >> $GITHUB_OUTPUT
          echo "æ²¡æœ‰æ£€æµ‹åˆ°æ•°æ®å˜åŒ–"
        else
          echo "has_changes=true" >> $GITHUB_OUTPUT
          echo "æ£€æµ‹åˆ°æ•°æ®å˜åŒ–"
        fi
    
    - name: Create Pull Request
      if: steps.check_changes.outputs.has_changes == 'true'
      uses: peter-evans/create-pull-request@v6
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: "chore: update AI news data [automated]"
        title: "ğŸ“° è‡ªåŠ¨æ›´æ–°ï¼šAIæŠ€æœ¯åŠ¨æ€æ•°æ®"
        body: |
          ## ğŸ¤– è‡ªåŠ¨æ›´æ–°çš„AIæ–°é—»æ•°æ®
          
          æ­¤PRç”±GitHub Actionsè‡ªåŠ¨ç”Ÿæˆï¼ŒåŒ…å«æœ€æ–°çš„AIæŠ€æœ¯åŠ¨æ€ã€‚
          
          ### æ›´æ–°å†…å®¹
          - æŠ“å–æ—¶é—´: ${{ github.event.repository.updated_at }}
          - æ•°æ®æ¥æº: OpenAI, Anthropic, Google AI, Hugging Faceç­‰
          
          ### å®¡æ ¸æ¸…å•
          - [ ] æ–°é—»å†…å®¹å‡†ç¡®æ— è¯¯
          - [ ] æ—¥æœŸæ ¼å¼æ­£ç¡®
          - [ ] æ¥æºé“¾æ¥å¯è®¿é—®
          - [ ] æ— æ•æ„Ÿæˆ–ä¸å½“å†…å®¹
          
          ### æ“ä½œ
          - å®¡æ ¸é€šè¿‡ï¼šåˆå¹¶æ­¤PR
          - éœ€è¦ä¿®æ”¹ï¼šåœ¨æ­¤PRä¸Šæäº¤ä¿®æ”¹
          - æ”¾å¼ƒæ›´æ–°ï¼šå…³é—­æ­¤PR
        
        branch: auto-update/ai-news
        delete-branch: true
        base: main
        labels: |
          automated
          ai-news
          needs-review
